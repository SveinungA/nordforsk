# POOL DATASETS

```{r POOL_setup, include=FALSE, echo=FALSE}
if(!require("gt")){install.packages("gt");  library(gt)}
if(!require("haven")){install.packages("haven");  library(haven)}
if(!require("here")){install.packages("here");  library(here)}
if(!require("kableExtra")){install.packages("kableExtra");  library(kableExtra)}
if(!require("knitr")){install.packages("knitr");  library(knitr)}
if(!require("magick")){install.packages("magick");  library(magick)}
if(!require("openxlsx")){install.packages("openxlsx");  library(openxlsx)}
if(!require("readxl")){install.packages("readxl");  library(readxl)}
if(!require("sjlabelled")){install.packages("sjlabelled");  library(sjlabelled)}
if(!require("tidyverse")){install.packages("tidyverse");  library(tidyverse)}
if(!require("utf8")){install.packages("utf8");  library(utf8)}
if(!require("webshot")){install.packages("webshot");  library(webshot)}

knitr::opts_chunk$set(echo = FALSE, knitr.kable.NA = "", cache = FALSE, message = FALSE )
```

```{r pool_load}
#Iceland
##Load data
di_pool <- read_sav('C:\\Users/svein/Documents/NORDFORSKdata/Terrorism_Iceland_EnglishLabels.sav')

## Select variables and rename to harmonized variable names
di_pool <- di_pool %>% select(ResponseId = ResponseId,
NORDFORSK1_TACTIC1 = taktikk1,
NORDFORSK1_TARGET = mal,
NORDFORSK1_CASUALTIES = personer,
NORDFORSK1_TACTIC2 = taktikk2,
NORDFORSK1_ADJECTIVE = adjektiv,
NORDFORSK1_SUBJECTIVE = subjekt,
NORDFORSK1_MOTIVATION = motivasjon,
NORDFORSK1_DV_A = sp3,
NORDFORSK1_DV_B_1 = sp4_1,
NORDFORSK1_DV_B_2 = sp4_2,
NORDFORSK1_DV_B_3 = sp4_3,
NORDFORSK1_DV_B_4 = sp4_4,
NORDFORSK1_DV_B_5 = sp4_5,
NORDFORSK1_DV_B_6 = sp4_6,
NORDFORSK1_DV_B_7 = sp4_7,
NORDFORSK2_OBJECT = terror_2a,
NORDFORSK2_TENSE = terror_2b,
NORDFORSK2_DV = sp5,
NORDFORSK3 = sp6,
NORDFORSK4 = sp7,
NORDFORSK5 = sp8,
NORDFORSK6_1 = sp9_1,
NORDFORSK6_2 = sp9_2,
NORDFORSK6_3 = sp9_3,
NORDFORSK6_4 = sp9_4,
NORDFORSK6_5 = sp9_5,
NORDFORSK6_6 = sp9_6,
NORDFORSK7_EVENT = terror10_a,
NORDFORSK7_DV = sp10,
NORDFORSK8_PRE = sp12,
sp13, sp14,
NORDFORSK8_DV_B = sp15,
NORDFORSK8_DV_C = sp16,
GENDER = Gender,
AGE = Age_groups,
EDUCATION = Educ
)

## Standardize sp13 and sp14 variables to harmonized format, separating the random assignment of treatment from post measure response
### ddi <- di %>% mutate(temp = case_when(is.na(sp13)) ~ 99) 
di_pool <- pivot_longer(di_pool, sp13:sp14, names_to = 'NORDFORSK8_TREAT', values_to = 'NORDFORSK8_DV', values_drop_na = TRUE)

#Norway
## Load data
dn_pool <- read_sav('C:\\Users/svein/Documents/nordforskdata/Norwegian Citizen Panel - wave 15 - EN.sav')
dn_pool <- dn_pool %>% select(starts_with('r15pad_terror'), responseid, r15P1, r15P4_2, r15P5_1) %>% filter(!is.na(r15pad_terror1_ran1))


## Select variables and rename to harmonized variable names
dn_pool <- dn_pool %>% select(ResponseId = responseid,
NORDFORSK1_TACTIC1 = r15pad_terror1_ran1,
NORDFORSK1_TARGET = r15pad_terror1_ran3,
NORDFORSK1_CASUALTIES = r15pad_terror1_ran4,
NORDFORSK1_TACTIC2 = r15pad_terror1_ran5,
NORDFORSK1_ADJECTIVE = r15pad_terror1_ran6,
NORDFORSK1_SUBJECTIVE = r15pad_terror1_ran7,
NORDFORSK1_MOTIVATION = r15pad_terror1_ran8,
NORDFORSK1_DV_A = r15pad_terror1_a,
NORDFORSK1_DV_B_1 = r15pad_terror1_b_1,
NORDFORSK1_DV_B_2 = r15pad_terror1_b_2,
NORDFORSK1_DV_B_3 = r15pad_terror1_b_3,
NORDFORSK1_DV_B_4 = r15pad_terror1_b_4,
NORDFORSK1_DV_B_5 = r15pad_terror1_b_5,
NORDFORSK1_DV_B_6 = r15pad_terror1_b_6,
NORDFORSK1_DV_B_7 = r15pad_terror1_b_7,
NORDFORSK2_OBJECT = r15pad_terror2_ran1,
NORDFORSK2_TENSE = r15pad_terror2_ran2,
NORDFORSK2_DV = r15pad_terror2,
NORDFORSK3 = r15pad_terror3,
NORDFORSK4 = r15pad_terror5,
NORDFORSK5 = r15pad_terror6,
NORDFORSK6_1 = r15pad_terror8_1,
NORDFORSK6_2 = r15pad_terror8_2,
NORDFORSK6_3 = r15pad_terror8_3,
NORDFORSK6_4 = r15pad_terror8_4,
NORDFORSK6_5 = r15pad_terror8_5,
NORDFORSK6_6 = r15pad_terror8_6,
NORDFORSK7_EVENT = r15pad_terror10_ran,
NORDFORSK7_DV = r15pad_terror10,
NORDFORSK8_PRE = r15pad_terror11pre,
NORDFORSK8_TREAT = r15pad_terror11_ran, 
NORDFORSK8_DV_A =  r15pad_terror11posta,
NORDFORSK8_DV_B =  r15pad_terror11postb,
NORDFORSK8_DV_C = r15pad_terror11postc,
GENDER = r15P1,
AGE = r15P5_1,
EDUCATION = r15P4_2) %>% 
  mutate(ResponseId = as.character(ResponseId),
         NORDFORSK1_TACTIC1 = as.character(NORDFORSK1_TACTIC1),
         NORDFORSK1_TARGET = as.character(NORDFORSK1_TARGET),
         NORDFORSK1_CASUALTIES = as.character(NORDFORSK1_CASUALTIES),
         NORDFORSK1_TACTIC2 = as.character(NORDFORSK1_TACTIC2),
         NORDFORSK1_ADJECTIVE = as.character(NORDFORSK1_ADJECTIVE),
         NORDFORSK1_SUBJECTIVE = as.character(NORDFORSK1_SUBJECTIVE),
         NORDFORSK1_MOTIVATION = as.character(NORDFORSK1_MOTIVATION),
         NORDFORSK2_OBJECT = as.character(NORDFORSK2_OBJECT),
         NORDFORSK2_TENSE = as.character(NORDFORSK2_TENSE),
         NORDFORSK7_EVENT = as.character(NORDFORSK7_EVENT),
         NORDFORSK8_TREAT = as.character(NORDFORSK8_TREAT)
  )
        

#Sweden
## Load data
ds <- read_dta('C:\\Users/svein/Documents/nordforskdata/s5_sohlberg.dta') 

## Select variables and rename to harmonized variable names
ds_pool <- ds %>% select(c(#ResponseId = responseid,
NORDFORSK1_TACTIC1 = q269_incidenttyp,
NORDFORSK1_TARGET = q269_plats,
NORDFORSK1_CASUALTIES = q269_omkomna,
NORDFORSK1_TACTIC2 = q269_incidenten,
NORDFORSK1_ADJECTIVE = q269_ideologi,
NORDFORSK1_SUBJECTIVE = q269_subjekt,
NORDFORSK1_MOTIVATION = q269_motiv,
NORDFORSK1_DV_A = q270,
NORDFORSK1_DV_B_1 = q272_1,
NORDFORSK1_DV_B_2 = q272_2,
NORDFORSK1_DV_B_3 = q272_3,
NORDFORSK1_DV_B_4 = q272_4,
NORDFORSK1_DV_B_5 = q272_5,
NORDFORSK1_DV_B_6 = q272_6,
NORDFORSK1_DV_B_7 = q272_7,
NORDFORSK2_OBJECT = q274_hot,
NORDFORSK2_TENSE = q274_tempus,
NORDFORSK2_DV = q274,
NORDFORSK3 = q276,
NORDFORSK4 = q278,
NORDFORSK5 = q280,
NORDFORSK6_1 = q282_1,
NORDFORSK6_2 = q282_2,
NORDFORSK6_3 = q282_3,
NORDFORSK6_4 = q282_4,
NORDFORSK6_5 = q282_5,
NORDFORSK6_6 = q282_6,
NORDFORSK7_EVENT = q284_kristyp,
NORDFORSK7_DV = q284,
NORDFORSK8_PRE = q286,
NORDFORSK8_TREAT = q288,
NORDFORSK8_DV_A =  q290,
NORDFORSK8_DV_B =  q292,
NORDFORSK8_DV_C = q294,
GENDER = sex,
AGE = age6,
EDUCATION = edu_mp36)
)
```

```{r pool_bind}
#Merge data sets from Iceland, Norway, and Sweden
d_pool <- bind_rows(di_pool, dn_pool)
```

```{r pool_eng_labels}
# Translate to values to English
d_pool <- d_pool %>% mutate(NORDFORSK1_TACTIC1 = case_when(NORDFORSK1_TACTIC1 == 1 ~ 'protest',
                                                           NORDFORSK1_TACTIC1 == 'Protest' ~ 'protest',
                                                NORDFORSK1_TACTIC1 == 2 ~ 'sabotage',
                                                NORDFORSK1_TACTIC1 == 'Sabotage' ~ 'sabotage',
                                                NORDFORSK1_TACTIC1 == 3 ~ 'hostage taking',
                                                NORDFORSK1_TACTIC1 == 'Hostage taking' ~ 'hostage taking',
                                                NORDFORSK1_TACTIC1 == 4 ~ 'shooting',
                                                NORDFORSK1_TACTIC1 == 'Shooting' ~ 'shooting',
                                                NORDFORSK1_TACTIC1 == 5 ~ 'bombing', 
                                                NORDFORSK1_TACTIC1 == 'Bombing' ~ 'bombing'), 
                            NORDFORSK1_TARGET = case_when(NORDFORSK1_TARGET == 1 ~ 'a military facility',
                                                           NORDFORSK1_TARGET == 'military facility' ~ 'a military facility',
                                                           NORDFORSK1_TARGET == 2 ~ 'a police station',
                                                           NORDFORSK1_TARGET == 'police station' ~ 'a police station',
                                                           NORDFORSK1_TARGET == 3 ~ 'a school',
                                                           NORDFORSK1_TARGET == 'school' ~ 'a school',
                                                           NORDFORSK1_TARGET == 4 ~ 'a church',
                                                           NORDFORSK1_TARGET == 'church' ~ 'a church',
                                                           NORDFORSK1_TARGET == 5 ~ 'a mosque',
                                                           NORDFORSK1_TARGET == 'mosque' ~ 'a mosque',
                                                           NORDFORSK1_TARGET == 6 ~ 'a synagogue',
                                                           NORDFORSK1_TARGET == 'synagogue' ~ 'a synagogue'),
                 NORDFORSK1_CASUALTIES = case_when(NORDFORSK1_CASUALTIES == 1 ~ 'No',
                                                   NORDFORSK1_CASUALTIES == 'No one was killed' ~ 'No',
                                                   NORDFORSK1_CASUALTIES == 2 ~ 'One person',
                                                   NORDFORSK1_CASUALTIES == 'One person' ~ 'One person',
                                                NORDFORSK1_CASUALTIES == 3 ~ 'Two people',
                                                NORDFORSK1_CASUALTIES == 'Two people' ~ 'Two people',
                                                NORDFORSK1_CASUALTIES == 4 ~ 'Ten people',
                                                NORDFORSK1_CASUALTIES == 'Ten people' ~ 'Ten people'),
                 NORDFORSK1_TACTIC2 = case_when(NORDFORSK1_TACTIC2 == 1 ~ 'the protest',
                                                NORDFORSK1_TACTIC2 == 'Protest' ~ 'the protest',
                                                NORDFORSK1_TACTIC2 == 2 ~ 'the sabotage',
                                                NORDFORSK1_TACTIC2 == 'Sabotage' ~ 'the sabotage',
                                                NORDFORSK1_TACTIC2 == 3 ~ 'the hostage taking',
                                                NORDFORSK1_TACTIC2 == 'Hostage taking' ~ 'the hostage taking',
                                                NORDFORSK1_TACTIC2 == 4 ~ 'the shooting',
                                                NORDFORSK1_TACTIC2 == 'Shooting' ~ 'the shooting',
                                                NORDFORSK1_TACTIC2 == 5 ~ 'the bombing',
                                                NORDFORSK1_TACTIC2 == 'Bombing' ~ 'the bombing'),
                 NORDFORSK1_ADJECTIVE = case_when(NORDFORSK1_ADJECTIVE == 1 ~ 'one',
                                                  NORDFORSK1_ADJECTIVE == 'one' ~ 'one',
                                                NORDFORSK1_ADJECTIVE == 2 ~ 'one Christian',
                                                NORDFORSK1_ADJECTIVE == 'one Christian' ~ 'one Christian',
                                                NORDFORSK1_ADJECTIVE == 3 ~ 'one Muslim',
                                                NORDFORSK1_ADJECTIVE == 'one Muslim' ~ 'one Muslim',
                                                NORDFORSK1_ADJECTIVE == 4 ~ 'one left-wing extremist',
                                                NORDFORSK1_ADJECTIVE == 'one left-wing extremist' ~ 'one left-wing extremist',
                                                NORDFORSK1_ADJECTIVE == 5 ~ 'one right-wing extremist',
                                                NORDFORSK1_ADJECTIVE == 'one right-wing extremist' ~ 'one right-wing extremist'),
                 NORDFORSK1_SUBJECTIVE = case_when(NORDFORSK1_SUBJECTIVE == 1 ~ 'organisation',
                                                   NORDFORSK1_SUBJECTIVE == 'organization' ~ 'organisation',
                                                NORDFORSK1_SUBJECTIVE == 2 ~ 'group',
                                                NORDFORSK1_SUBJECTIVE == 'group' ~ 'group',
                                                NORDFORSK1_SUBJECTIVE == 3 ~ 'individual',
                                                NORDFORSK1_SUBJECTIVE == 'indiviudal' ~ 'individual',
                                                NORDFORSK1_SUBJECTIVE == 4 ~ 'individual of unsound mind',
                                                NORDFORSK1_SUBJECTIVE == 'individual of unsound mind' ~ 'individual of unsound mind'),
                 NORDFORSK1_MOTIVATION = case_when(NORDFORSK1_MOTIVATION == 1 ~ 'there was no clear motivation behind the incident',
                                                   NORDFORSK1_MOTIVATION == 'there was no clear motivation behind the incident' ~ 'there was no clear motivation behind the incident',
                                                NORDFORSK1_MOTIVATION == 2 ~ 'the incident was carried out with the aim of changing government policy',
                                                NORDFORSK1_MOTIVATION == 'the incident was carried out with the aim of changing goverment policy' ~ 'the incident was carried out with the aim of changing government policy',
                                                NORDFORSK1_MOTIVATION == 3 ~ 'the motivation behind the incident came from a hatred towards the target',
                 NORDFORSK1_MOTIVATION == 'the motivation behind the incident came from a hatred towards the target' ~ 'the motivation behind the incident came from a hatred towards the target'),
                 NORDFORSK2_OBJECT = case_when(NORDFORSK2_OBJECT == 1 ~ 'you personally',
                                               NORDFORSK2_OBJECT == 'for you personally' ~ 'you personally',
                                                NORDFORSK2_OBJECT == 2 ~ '[country]',
                                               NORDFORSK2_OBJECT == 'Iceland' ~ '[country]',
                                                NORDFORSK2_OBJECT == 3 ~ 'Europe',
                                               NORDFORSK2_OBJECT == 'Europe' ~ 'Europe'),
                 NORDFORSK2_TENSE = case_when(NORDFORSK2_TENSE == 1 ~ 'today',
                                              NORDFORSK2_TENSE == 'today' ~ 'today',
                                                NORDFORSK2_TENSE == 2 ~ 'in the future',
                                              NORDFORSK2_TENSE == 'in the future' ~ 'in the future'),
                   NORDFORSK7_EVENT = case_when(NORDFORSK7_EVENT == 1 ~ 'natural disasters',
                                                NORDFORSK7_EVENT == 'natural disasters' ~ 'natural disasters',
                                                NORDFORSK7_EVENT == 2 ~ 'terrorist attack',
                                                NORDFORSK7_EVENT == 'terrorist attack' ~ 'terrorist attack')

                 )
```


